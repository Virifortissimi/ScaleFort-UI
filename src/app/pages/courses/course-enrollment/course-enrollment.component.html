<form *ngIf="!showPricePlans()" [formGroup]="formGroup" class="max-w-3xl mx-auto">
    <div class="grid gap-6 grid-cols-1 sm:grid-cols-2">
        <!-- Company Name (Conditional) -->
        <div class="mb-4 col-span-2" *ngIf="departmentType() === 2">
            <label for="companyName" class="block text-sm font-medium text-gray-700 mb-2">
                Company Name <span class="text-red-500">*</span>
            </label>
            <input type="text" name="companyName" formControlName="companyName"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all shadow-sm">
            <span *ngIf="formGroup.get('companyName')?.invalid && (formGroup.get('companyName')?.dirty || formGroup.get('companyName')?.touched)"
                class="block mt-1 text-sm text-red-600">
                Company name is required.
            </span>
        </div>

        <div class="mb-4">
            <label for="firstName" class="block text-sm font-medium text-gray-700 mb-2">
                First Name <span class="text-red-500">*</span>
            </label>
            <input 
                type="text" 
                name="firstName" 
                formControlName="firstName"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all shadow-sm"
                [ngClass]="{'bg-[var(--p-form-field-disabled-background)]': userDetails()}"
                [readOnly]="userDetails()"
            >
            <span *ngIf="formGroup.get('firstName')?.invalid && (formGroup.get('firstName')?.dirty || formGroup.get('firstName')?.touched)"
                class="block mt-1 text-sm text-red-600">
                First name is required.
            </span>
        </div>

        <div class="mb-4">
            <label for="lastName" class="block text-sm font-medium text-gray-700 mb-2">
                Last Name <span class="text-red-500">*</span>
            </label>
            <input 
                type="text" 
                name="lastName" 
                formControlName="lastName"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all shadow-sm"
                [ngClass]="{'bg-[var(--p-form-field-disabled-background)]': userDetails()}"
                [readOnly]="userDetails()"
            >
            <span *ngIf="formGroup.get('lastName')?.invalid && (formGroup.get('lastName')?.dirty || formGroup.get('lastName')?.touched)"
                class="block mt-1 text-sm text-red-600">
                Last name is required.
            </span>
        </div>

        <!-- Email -->
        <div class="mb-4 col-span-2">
            <label for="email" class="block text-sm font-medium text-gray-700 mb-2">
                Email <span class="text-red-500">*</span>
            </label>
            <input 
                type="email" 
                name="email" 
                formControlName="email"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all shadow-sm"
                [ngClass]="{'bg-[var(--p-form-field-disabled-background)]': userDetails()}"
                [readOnly]="userDetails()"
            >
            <!-- e2e8f0 -->
            <span *ngIf="formGroup.get('email')?.invalid && (formGroup.get('email')?.dirty || formGroup.get('email')?.touched)"
                class="block mt-1 text-sm text-red-600">
                <span *ngIf="formGroup.get('email')?.errors?.['required']">
                    Email is required.
                </span>
                <span *ngIf="formGroup.get('email')?.errors?.['email']">
                    Please enter a valid email address.
                </span>
            </span>
        </div>

        <!-- Phone Number -->
        <div class="mb-4 col-span-2">
            <label class="block text-sm font-medium text-gray-700 mb-2">
                Phone Number <span class="text-red-500">*</span>
            </label>
            <input type="tel" name="phoneNumber" formControlName="phoneNumber"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all shadow-sm">
            <span *ngIf="formGroup.get('phoneNumber')?.invalid && (formGroup.get('phoneNumber')?.dirty || formGroup.get('phoneNumber')?.touched)"
                class="block mt-1 text-sm text-red-600">
                <span *ngIf="formGroup.get('phoneNumber')?.errors?.['required']">
                    Phone number is required.
                </span>
                <span *ngIf="formGroup.get('phoneNumber')?.errors?.['minlength'] || formGroup.get('phoneNumber')?.errors?.['maxlength'] || formGroup.get('phoneNumber')?.errors?.['pattern']">
                    Please enter a valid 11-digit phone number.
                </span>
            </span>
        </div>

        <!-- Referral ID -->
        <div class="mb-4 col-span-2">
            <label for="referralId" class="block text-sm font-medium text-gray-700 mb-2">
                Referral ID <span class="text-gray-400">(Optional)</span>
            </label>
            <input 
                type="text" 
                name="referralId" 
                formControlName="referralId"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all shadow-sm"
            >

            <span
                *ngIf="formGroup.get('referralId')?.pending"
                class="block mt-1 text-sm text-gray-500"
            >
                Checking referral ID...
            </span>
            <span 
                *ngIf="
                    formGroup.get('referralId')?.invalid &&
                    formGroup.get('referralId')?.errors?.['referralIdNotFound'] &&
                    (formGroup.get('referralId')?.dirty || formGroup.get('referralId')?.touched)
                "
                class="block mt-1 text-sm text-red-600"
            >
                The referral ID you entered does not exist.
            </span>
        </div>

        <!-- Message -->
        <div class="mb-4 col-span-2">
            <label for="message" class="block text-sm font-medium text-gray-700 mb-2">
                Message <span class="text-gray-400">(Optional)</span>
            </label>
            <textarea name="message" formControlName="message" rows="4"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all shadow-sm"></textarea>
        </div>
    </div>

    <!-- Submit Button -->
    <div class="mt-8">
        <p-button label="Submit Application" [loading]="isLoading()"
            [styleClass]="'w-full !bg-gradient-to-r !from-purple-600 !to-blue-600 text-white !border-0 font-semibold !py-3.5 !rounded-lg !hover:from-purple-700 !hover:to-blue-700 transition-all transform hover:scale-[1.01] shadow-lg hover:shadow-purple-500/20'"
            [disabled]="!formGroup.valid" (click)="submitEnrollment()" />
    </div>
</form>


<app-price-plan 
    *ngIf="showPricePlans()" 
    [userEmail]="userEmail()" 
    [applicationId]="applicationId()"
    [referralId]="referralId()"
    (closeDialog)="closeDialog()"
></app-price-plan>